<!DOCTYPE html>
<html>
  <head>
    <title>Address Verification System</title>
  </head>
  <body>
    <h1>Address Verification System</h1>
    <table id="accounts">
      <tr>
        <th>Account Number</th>
        <th>Balance</th>
      </tr>
    </table>
    <br />
    <button id="start" onclick="startTransaction()">Start</button>
    <button id="stop" onclick="stopTransaction()" disabled>Stop</button>
    <br /><br />
    <p>Last Transacted Amount: <span id="last-amount"></span></p>
    <p>Time taken by last transaction: <span id="time-taken"></span></p>

    <p>Total Balance: <span id="total-balance"></span></p>

    <p>Transaction Counter: <span id="counter"></span></p>
    <p>E notation: <span id="counter-2"></span></p>
    <p>Aleph null: <span id="counter-3"></span></p>

    <script>
      var startTime;
      var endTime;
      var interval;
      var accounts;
      var counter = 0;
      var secondCounter = 0;
      var thirdCounter = 0;
      var totalBalance = 0;
      // Read the accounts.csv file and display it in the table
      function readCSV() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "accounts.csv", true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            accounts = xhr.responseText.split("\n");
            for (var i = 1; i < accounts.length; i++) {
              var account = accounts[i].split(",");
              var accountNumber = account[0];
              var balance = account[1];
              var row = document.createElement("tr");
              var accountNumberCell = document.createElement("td");
              var balanceCell = document.createElement("td");
              accountNumberCell.innerHTML = accountNumber;
              balanceCell.innerHTML = balance;
              row.appendChild(accountNumberCell);
              row.appendChild(balanceCell);
              document.getElementById("accounts").appendChild(row);
            }
          }
        };
        xhr.send();
      }

      // Start the auto transaction
      function startTransaction() {
        startTime = Date.now();
        totalBalance = 0;
        document.getElementById("start").disabled = true;
        document.getElementById("stop").disabled = false;
        interval = setInterval(transact, 0.000000000001);
      }

      // Stop the auto transaction
      function stopTransaction() {
        document.getElementById("start").disabled = false;
        document.getElementById("stop").disabled = true;
        clearInterval(interval);
      }

      // Perform a transaction between two random accounts
      // var secondCounter = 0;

      function transact() {
        var account1 = Math.floor(Math.random() * 10) + 1;
        var account2 = Math.floor(Math.random() * 10) + 1;
        while (account1 == account2) {
          account2 = Math.floor(Math.random() * 10) + 1;
        }

        var account1Data = accounts[account1].split(",");
        var account2Data = accounts[account2].split(",");
        var account1Balance = parseFloat(account1Data[1]);
        var account2Balance = parseFloat(account2Data[1]);
        var amount = Math.random() * (account1Balance - 1) + 1;
        amount = parseFloat(amount.toFixed(2));
        document.getElementById("last-amount").innerHTML = amount;
        // var endTime = Date.now();
        // var timeTaken = endTime - startTime + "ms";
        // document.getElementById("time-taken").innerHTML = timeTaken;

        var newBalance1 = account1Balance - amount;
        var newBalance2 = account2Balance + amount;
        account1Data[1] = newBalance1;
        account2Data[1] = newBalance2;
        accounts[account1] = account1Data.join(",");
        accounts[account2] = account2Data.join(",");
        var rows = document.getElementsByTagName("tr");
        for (var i = 1; i < rows.length; i++) {
          var accountNumber = rows[i].childNodes[0].innerHTML;
          if (
            accountNumber == account1Data[0] ||
            accountNumber == account2Data[0]
          ) {
            var balance = accounts[i].split(",")[1];
            rows[i].childNodes[1].innerHTML = balance;
            totalBalance += parseFloat(balance);
          }
        }
        counter++;

        if (counter >= 999) {
          var exponent = Math.floor(counter / 1000);
          var firstCounter = 1;
          secondCounter = secondCounter + 1;
          if (secondCounter >= 293) {
            thirdCounter = thirdCounter + 1;
            secondCounter = 1;
          }
          document.getElementById("counter").innerHTML = firstCounter;
          document.getElementById("counter-2").innerHTML = secondCounter;
          document.getElementById("counter-3").innerHTML = thirdCounter;
          counter = 1;
        } else {
          document.getElementById("counter").innerHTML = counter;
        }

        // recalculate total balance
        totalBalance = 0;
        for (var i = 1; i < accounts.length; i++) {
          var account = accounts[i].split(",");
          var balance = parseFloat(account[1]);
          totalBalance += balance;
        }
        // update total balance displayed on the page
        document.getElementById("total-balance").innerHTML =
          totalBalance.toFixed(2);

        var endTime = Date.now();
        var timeTaken = endTime - startTime;
        document.getElementById("time-taken").innerHTML = timeTaken + "ms";
        startTime = Date.now();
      }

      // Call the readCSV function to display the accounts table
      readCSV();
    </script>
  </body>
</html>
